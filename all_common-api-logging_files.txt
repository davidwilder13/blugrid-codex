===== ./common/common-kotlin/common-api/common-api-logging/src/main/kotlin/net/blugrid/api/logging/Logger.kt =====
package net.blugrid.api.logging

import org.slf4j.LoggerFactory
import kotlin.reflect.full.companionObject

inline fun <reified R : Any> R.logger() = logger(R::class.java)

fun logger(clazz: Class<*>) = LoggerFactory.getLogger(unwrapCompanionClass(clazz))

// unwrap companion class to enclosing class given a Java Class
private fun <T : Any> unwrapCompanionClass(ofClass: Class<T>): Class<*> {
    return if (ofClass.enclosingClass != null && ofClass.enclosingClass.kotlin.companionObject?.java == ofClass) {
        ofClass.enclosingClass
    } else {
        ofClass
    }
}

===== ./common/common-kotlin/common-api/common-api-logging/src/main/resources/application-logging.yml =====
logger:
  levels:
    net.blugrid.api: DEBUG

===== ./common/common-kotlin/common-api/common-api-logging/src/main/resources/application-test-logging.yml =====

logger:
  levels:
    net.blugrid.api: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.orm.jdbc.extract: TRACE
    org.hibernate.orm.jdbc.bind: TRACE

===== ./common/common-kotlin/common-api/common-api-logging/src/main/resources/application-debug-logging.yml =====

logger:
  levels:
    net.blugrid.api: DEBUG
#    org.hibernate: TRACE
    org.hibernate.SQL: DEBUG
    org.hibernate.orm.jdbc.extract: TRACE
    org.hibernate.orm.jdbc.bind: TRACE
    org.hibernate.engine.transaction.internal.TransactionImpl: DEBUG
    io.micronaut.http.client: TRACE
    io.micronaut.discovery: INFO
    io.micronaut.http.server: TRACE
    io.micronaut.json: INFO
    io.micronaut.security: DEBUG

===== ./common/common-kotlin/common-api/common-api-logging/build.gradle.kts =====
plugins {
    alias(libs.plugins.jvm)
    alias(libs.plugins.kapt)
    alias(libs.plugins.allopen)
    alias(libs.plugins.application)
}

dependencies {
    // API dependencies - expose to consumers
    api(project(":common:common-kotlin:common-api:common-api-model"))

    // Platform BOM
    implementation(platform(libs.micronaut.bom))

    // Core dependencies using new bundles
    implementation(libs.bundles.kotlinCore)
    implementation(libs.bundles.micronautCore)

    // Logging-specific dependencies
    implementation(libs.logback.classic)         // Primary logging implementation
    implementation(libs.micronaut.jackson)       // For structured logging (JSON)
    implementation(libs.jackson.kotlin)          // Kotlin support for JSON logging

    // Annotation processing
    kapt(libs.bundles.annotationProcessors)

    // Compile-only dependencies
    compileOnly(libs.bundles.compileOnly)

    // Runtime dependencies
    runtimeOnly(libs.bundles.runtimeCore)

    // Test dependencies
    testImplementation(libs.bundles.testing) {
        exclude(group = "org.slf4j", module = "slf4j-api")
    }
}

java {
    sourceCompatibility = JavaVersion.toVersion("17")
}

kapt {
    arguments {
        arg("micronaut.openapi.project.dir", projectDir.toString())
    }
}

graalvmNative.toolchainDetection = false
micronaut {
    runtime("netty")
    testRuntime("junit5")
    processing {
        incremental(true)
        annotations("net.blugrid.api.*")
    }
}

===== ./common/common-kotlin/common-api/common-api-logging/gradle.properties =====
micronautVersion=4.4.3
kotlinVersion=1.9.23


{# templates/gradle/build.gradle.kts.j2 #}
{# Generates Gradle build files for Kotlin modules #}
{# Based on: codegen/src/generators/kotlin/templates/common/GradleBuildFileTemplate.ts #}

plugins {
    alias(libs.plugins.jvm)
    alias(libs.plugins.kapt)
    alias(libs.plugins.allopen)
{%- if includeDb %}
    alias(libs.plugins.jpa)
{%- endif %}
    alias(libs.plugins.shadow)
    alias(libs.plugins.application)
}

version = "{{ version }}"
group = "{{ group }}"

repositories {
    mavenCentral()
}

dependencies {
    api(project(":common-api:common-api:common-api-model"))
    api(project(":common-api:common-api:common-api-json"))
{%- if includeDb %}
    api(project(":common-api:common-api:common-api-db"))
    api(project(":common-api:common-api:common-api-multitenant"))
{%- endif %}
{%- if includeSecurity %}
    api(project(":common-api:common-api:common-api-security"))
{%- endif %}

{%- if coreDependencies %}
    {% for dep in coreDependencies %}
    api(project(":core-api:core-{{ dep.name }}-api:core-{{ dep.name }}-api-{{ dep.type }}"))
{%- endfor %}
{%- endif %}

    implementation(platform("io.micronaut.platform:micronaut-platform"))
    kapt(annotationProcessorLibs.bundles.commonAnnotationProcessors)
    implementation(libs.bundles.commonLibs)
{%- if includeDb %}
    implementation(libs.bundles.dbLibs)
{%- endif %}
{%- if includeWebService %}
    implementation(libs.bundles.webServiceLibs)
{%- endif %}
{%- if includeSecurity %}
    implementation(libs.bundles.securityLibs)
{%- endif %}

    runtimeOnly(runTimeLibs.bundles.commonRuntimeLibs)
{%- if includeDb %}
    runtimeOnly(runTimeLibs.bundles.dbRuntimeLibs)
{%- endif %}
{%- if includeSecurity %}
    runtimeOnly(runTimeLibs.bundles.securityRuntimeLibs)
{%- endif %}

    compileOnly(libs.bundles.compileOnlyLibs)
{%- if includeTest %}
    testImplementation(project(":common-api:common-api:common-api-test"))
    testImplementation(testLibs.bundles.testImplementationLibs) {
        exclude(group = "org.slf4j", module = "slf4j-api")
    }
{%- endif %}
}

{%- if mainClassName %}

application {
    mainClass.set("{{ mainClassName }}")
}
{%- endif %}

java {
    sourceCompatibility = JavaVersion.toVersion("17")
}

kapt {
    arguments {
        arg("micronaut.openapi.project.dir", projectDir.toString())
    }
}

kotlin {
    jvmToolchain {
        languageVersion.set(JavaLanguageVersion.of(17))
    }
}

graalvmNative.toolchainDetection = false

micronaut {
    runtime("netty")
    testRuntime("junit5")
    processing {
        incremental(true)
        annotations("{{ packageName }}.*")
    }
}
